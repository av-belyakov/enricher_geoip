# Readme

Сервис 'enricher_geoip' выполняет запросы к базе данных НКЦКИ с целью получения данных о геопозиционировании ip адресов.

## Конфигурационные настройки

Конфигурационные параметры для сервиса, могут быть заданы как через конфигурационный файл, так и методом установки переменных окружения. Однако, все пароли и ключевые токены, используемые для авторизации, задаются ТОЛЬКО через переменные окружения.

#### Типы конфигурационных файлов:

- config.yml общий конфигурационный файл, здесь хранятся настройки логирования и параметры доступа к Zabbix;
- config_dev.yml конфигурационный файл используемый при развертывании тестовой инфраструктуры максимально приближенной к продуктовой;
- config_prod.yml конфигурационный файл применяемый в продуктовом режиме.

Основная переменная окружения для данного приложения - GO_ENRICHERGEOIP_MAIN. На основании значения этой переменной принимается решение какой из конфигурационных файлов config_dev.yml или config_prod.yml использовать. При GO_ENRICHERGEOIP_MAIN=development будет использоваться config_dev.yml, во всех остальных случаях, в том числе и при отсутствии переменной окружения GO_ENRICHERGEOIP_MAIN будет использоваться конфигурационный файл config_prod.yml. Перечень переменных окружения которые можно использовать для настройки приложения:

#### Переменная окружения отвечающая за тип запуска приложения "development" или "production"

- GO_ENRICHERGEOIP_MAIN

#### Переменные окружения отвечающие за подключение к NATS

- GO_ENRICHERGEOIP_NHOST - ip или доменное имя;
- GO_ENRICHERGEOIP_NPORT - сетевой порт;
- GO_ENRICHERGEOIP_NCACHETTL - данный параметр должен содержать время жизни записи
  кэша, по истечение которого запись автоматически удаляется, значение задается
  в секундах в диапазоне от 10 до 86400 секунд;
- GO_ENRICHERGEOIP_NSUBSCR - подписка для приёма запросов на выполнение поиска информации о геопозиционировани.

#### Переменные окружения отвечающие за подключение к GeoIP БД

- GO_ENRICHERGEOIP_GIPHOST - ip или доменное имя;
- GO_ENRICHERGEOIP_GIPPOST - сетевой порт;
- GO_ENRICHERGEOIP_GIPPATH - сетевой путь.

#### Переменные окружения отвечающие за настройку доступа к БД применяемой для хранения логов

- GO_ENRICHERGEOIP_DBWLOGHOST - доменное имя или ip БД
- GO_ENRICHERGEOIP_DBWLOGPORT - порт БД
- GO_ENRICHERGEOIP_DBWLOGNAME - наименование БД (при необходимости)
- GO_ENRICHERGEOIP_DBWLOGUSER - пользователь БД
- GO_ENRICHERGEOIP_DBWLOGPASSWD - пароль для доступа к БД
- GO_ENRICHERGEOIP_DBWLOGSTORAGENAME - наименование объекта хранения логов (таблица, документ, индекс и т.д. зависит от типа БД)

Настройки логирования данных в БД не являются обязательными и необходимы только если пользователь приложения желает хранить логи в базе данных.

Приоритет значений заданных через переменные окружения выше чем значений полученных из конфигурационных файлов. Таким образом можно осуществлять гибкую временную настройку приложения.
